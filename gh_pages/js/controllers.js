// Generated by CoffeeScript 1.9.3
(function() {
  var videosubApp;

  videosubApp = angular.module('videosubApp', ['yqlService', 'parseService']);

  videosubApp.controller('videosubCtrl', [
    '$scope', '$sce', 'getHTMLwithYQL', 'parsers', function($scope, $sce, getHTMLwithYQL, parsers) {
      var url;
      $scope.titleQuery = 'modern';
      $scope.trustSrc = function(src) {
        return $sce.trustAsResourceUrl(src);
      };
      url = 'http://www.springfieldspringfield.co.uk/tv_show_episode_scripts.php?search=modern';
      getHTMLwithYQL(url).then(function(htmlStr) {
        var items;
        items = parsers.getTitlesFromSpringfield(htmlStr);
        $scope.springfieldTitleSuggestions = items;
        return $scope.springfieldTitle = items[0].val;
      });
      $scope.searchTitles = function() {
        getTitlesFromSpringfield($scope.titleQuery, function(items) {
          $scope.springfieldTitleSuggestions = items;
          $scope.springfieldTitle = items[0].val;
          return $scope.$apply();
        });
        return getTitlesFromTVOnline($scope.titleQuery, function(items) {
          $scope.tvonlineTitleSuggestions = items;
          $scope.tvonlineTitle = items[0].val;
          return $scope.$apply();
        });
      };
      $scope.searchEpisodes = function() {
        getEpisodesFromSpringfield($scope.springfieldTitle, function(items) {
          $scope.springfieldEpisodes = items;
          $scope.springfieldEpisode = items[0].val;
          return $scope.$apply();
        });
        return getEpisodesFromTVOnline($scope.tvonlineTitle, function(items) {
          $scope.tvonlineEpisodes = items;
          $scope.tvonlineEpisode = items[0].val;
          return $scope.$apply();
        });
      };
      $scope.showVideo = function() {
        return getEmbedVideos($scope.tvonlineEpisode, function(items) {
          $scope.embedVideoUrls = items;
          $scope.embedVideoUrl = items[0].val;
          return $scope.$apply();
        });
      };
      return $scope.showSubtitle = function() {
        return getSubtitle($scope.springfieldEpisode, function(text) {
          $scope.subtitle = text;
          return $scope.$apply();
        });
      };
    }
  ]);

}).call(this);
